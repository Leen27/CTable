# 表格渲染测试文档

这个测试文件 [`table-rendering.test.ts`](table-rendering.test.ts) 是基于 [`packages/table-core/story/main.ts`](../story/main.ts) 创建的表格渲染功能测试。

## 测试覆盖范围

### 1. 基本表格创建和渲染
- ✅ 表格结构创建验证
- ✅ DOM容器渲染测试
- ✅ maxHeight属性应用测试
- ✅ 行数正确性验证
- ✅ 空数据处理

### 2. 列配置测试
- ✅ 不同列类型处理（基本列、计算列）
- ✅ 自定义单元格渲染器
- ✅ 列ID验证

### 3. 表格状态管理
- ✅ 状态变化处理
- ✅ 状态重置功能

### 4. 表格事件
- ✅ 表格挂载事件分发

### 5. 表格清理
- ✅ 表格销毁和DOM清理

### 6. 错误处理
- ✅ 缺失容器引用处理
- ✅ 无效列访问处理

## 测试数据结构

使用与示例代码相同的数据结构：

```typescript
type Person = {
  firstName: string
  lastName: string
  age: number
  visits: number
  status: string
  progress: number
}
```

## 关键测试辅助函数

### createTestTable()
这个辅助函数封装了创建测试表格的复杂配置，包括：
- 必要的状态配置（renderGrid和virtual状态）
- 事件处理函数
- 行高设置

## 运行测试

```bash
cd packages/table-core
npm run test:unit -- __test__/table-rendering.test.ts
```

## 测试特点

1. **完整性**: 覆盖了表格渲染的核心功能
2. **独立性**: 每个测试都在干净的DOM环境中运行
3. **可维护性**: 使用辅助函数减少重复代码
4. **错误处理**: 包含负面测试场景
5. **状态管理**: 正确处理复杂的虚拟滚动状态

## 与示例代码的对应关系

测试代码完全基于 [`main.ts`](../story/main.ts) 的功能实现，确保测试的实用性和相关性。主要对应关系：

- 数据结构相同（Person类型）
- 列配置相同（使用createColumnHelper）
- 渲染逻辑相同（包含虚拟滚动状态）
- DOM结构验证（验证生成的CSS类名）

这个测试文件为表格渲染功能提供了全面的测试覆盖，确保核心功能的稳定性和可靠性。

# 行渲染测试文档

这个测试文件 [`row-rendering.test.ts`](row-rendering.test.ts) 是专门针对表格行渲染功能的详细测试。

## 测试覆盖范围

### 1. 行高管理
- ✅ 行默认高度初始化
- ✅ 自定义行高函数处理
- ✅ 估计行高机制
- ✅ 手动设置行高
- ✅ 行高重新计算
- ✅ 最小行高限制（1像素）

### 2. 行定位
- ✅ 行顶部位置设置
- ✅ 基于索引和高度的自动位置计算

### 3. 行渲染功能
- ✅ 行元素首次渲染
- ✅ 重复渲染优化（不创建新元素）
- ✅ 正确高度应用
- ✅ 行元素附加到表格内容
- ✅ 行GUI元素获取

### 4. 行显示状态
- ✅ 显示状态跟踪

### 5. 行清理
- ✅ 表格销毁时的DOM清理

### 6. 边界情况处理
- ✅ 未定义getRowHeight函数处理
- ✅ 无效的getRowHeight结果处理
- ✅ 非数字getRowHeight结果处理

## 关键技术点

### 动态行高计算
测试验证了行高计算的两种模式：
1. **估计模式**：使用默认高度进行初步计算
2. **实际模式**：调用自定义函数获取真实高度

### 行定位机制
验证了基于`transform: translateY()`的绝对定位机制，确保行在虚拟滚动中的正确位置。

### 渲染优化
测试确认行元素只会在首次渲染时创建，后续渲染会复用已有元素，提高性能。

## 运行测试

```bash
cd packages/table-core
npm run test:unit -- __test__/row-rendering.test.ts
```

## 测试特点

1. **深度覆盖**：专门针对RowRender功能的详细测试
2. **边界情况**：包含各种异常输入的处理
3. **性能关注**：验证渲染优化机制
4. **状态验证**：确保行状态管理的正确性
5. **DOM操作**：验证实际的DOM创建和清理过程

这个测试文件为表格的行渲染功能提供了全面的质量保障，确保在各种使用场景下都能正常工作。